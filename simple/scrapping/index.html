
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="NLP Project for the Deep Learning course of the MVA master">
      
      
        <meta name="author" content="Gabriel WATKINSON <gabriel.watkinson@ensae.fr>, JÃ©remie STYM-POPPER <jeremie.stym-popper@ensae.fr>">
      
      
      <link rel="icon" href="../../images/logo.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.3.9">
    
    
      
        <title>Scrapping the data - NLP and French politic</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-the-data" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="NLP and French politic" class="md-header__button md-logo" aria-label="NLP and French politic" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NLP and French politic
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Scrapping the data
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/gwatkinson/NLP_Assemblee" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    gwatkinson/NLP_Assemblee
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="NLP and French politic" class="md-nav__button md-logo" aria-label="NLP and French politic" data-md-component="logo">
      
  <img src="../../images/logo.png" alt="logo">

    </a>
    NLP and French politic
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/gwatkinson/NLP_Assemblee" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    gwatkinson/NLP_Assemblee
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Setup" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/scrapping/" class="md-nav__link">
        Fetch the data from the web
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/data_processing/" class="md-nav__link">
        Processing the data compiled from the API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/precompute/" class="md-nav__link">
        Precompute the embeddings for the training and test set
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Experiments
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Experiments" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Experiments
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/experiments/dummy_classifier/" class="md-nav__link">
        Dummy Classifier
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/experiments/baseline/" class="md-nav__link">
        Baseline
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/experiments/lm_model_selection/" class="md-nav__link">
        Choosing the Language Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/experiments/choose_optimizer/" class="md-nav__link">
        Choosing the optimizer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/experiments/new_features/" class="md-nav__link">
        Finetuning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/experiments/topic_modelling/" class="md-nav__link">
        Topic Modelling
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Python API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python API" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Python API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Scrapping the data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Scrapping the data
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#wrapper-function" class="md-nav__link">
    Wrapper function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.fetch_data_for_legislature" class="md-nav__link">
    nlp_assemblee.api.fetch_data_for_legislature
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cpcapi" class="md-nav__link">
    CPCApi
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi" class="md-nav__link">
    nlp_assemblee.api.CPCApi
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.async_fetch_all_interventions" class="md-nav__link">
    async_fetch_all_interventions()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.async_fetch_interventions_of_deputy" class="md-nav__link">
    async_fetch_interventions_of_deputy()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.async_get_all_interventions_urls" class="md-nav__link">
    async_get_all_interventions_urls()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.async_get_deputy_interventions_urls" class="md-nav__link">
    async_get_deputy_interventions_urls()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.get_deputies_df" class="md-nav__link">
    get_deputies_df()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.parlementaires" class="md-nav__link">
    parlementaires()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.process_response" class="md-nav__link">
    process_response()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.search_parlementaires" class="md-nav__link">
    search_parlementaires()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.urls_response" class="md-nav__link">
    urls_response()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_processing/" class="md-nav__link">
        Data Processing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../precompute/" class="md-nav__link">
        Precomputing the Embeddings
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dataset/" class="md-nav__link">
        Building the Pytorch Dataset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trainer/" class="md-nav__link">
        Pytorch Lightning Module and Trainer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../visualisation/" class="md-nav__link">
        Visualisation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Older API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Older API" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Older API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../complex/dataset/" class="md-nav__link">
        Building the Pytorch Dataset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../complex/models/" class="md-nav__link">
        Building the Pytorch Modules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../complex/trainer/" class="md-nav__link">
        Building the Trainer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#wrapper-function" class="md-nav__link">
    Wrapper function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.fetch_data_for_legislature" class="md-nav__link">
    nlp_assemblee.api.fetch_data_for_legislature
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cpcapi" class="md-nav__link">
    CPCApi
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi" class="md-nav__link">
    nlp_assemblee.api.CPCApi
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.async_fetch_all_interventions" class="md-nav__link">
    async_fetch_all_interventions()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.async_fetch_interventions_of_deputy" class="md-nav__link">
    async_fetch_interventions_of_deputy()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.async_get_all_interventions_urls" class="md-nav__link">
    async_get_all_interventions_urls()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.async_get_deputy_interventions_urls" class="md-nav__link">
    async_get_deputy_interventions_urls()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.get_deputies_df" class="md-nav__link">
    get_deputies_df()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.parlementaires" class="md-nav__link">
    parlementaires()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.process_response" class="md-nav__link">
    process_response()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.search_parlementaires" class="md-nav__link">
    search_parlementaires()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nlp_assemblee.api.CPCApi.urls_response" class="md-nav__link">
    urls_response()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/gwatkinson/NLP_Assemblee/edit/master/docs/simple/scrapping.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  



<h1 id="getting-the-data">Getting the data<a class="headerlink" href="#getting-the-data" title="Permanent link">&para;</a></h1>
<p>For this project, we used data made openly available by <a href="https://www.assemblee-nationale.fr/">assemblee-nationale.fr/</a>.</p>
<p>The site <a href="https://www.nosdeputes.fr">nosdeputes.fr</a> wrote a API to simplify the acces to the data.
We used this website to fetch the textual data used in the project.</p>
<h2 id="wrapper-function">Wrapper function<a class="headerlink" href="#wrapper-function" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Wrapper function</p>
<p>We defined a wrapper function to simplify the use of the API. It fetches all the urls, interventions and the deputies information for a given legislature.</p>
<p>It is used to fetch the data in the <a href="../../notebooks/scrapping/">notebook</a>.</p>
</div>


<div class="doc doc-object doc-function">


<a id="nlp_assemblee.api.fetch_data_for_legislature"></a>
  <div class="doc doc-contents first">
  
      <p>Fetch data for a given legislature, including interventions and deputies
data.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>legislature</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the legislature to fetch data for.</p></td>
          <td>
                <code>&#39;2017-2022&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>root_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>the root directory to save data.</p></td>
          <td>
                <code>&#39;./data/&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>max_interventions</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>the maximum number of interventions to fetch.</p></td>
          <td>
                <code>500</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>uresults</code></td>          <td>
                <code>tuple</code>
          </td>
          <td><p>containing the urls of the interventions, the interventions data
and the deputies data</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>nlp_assemblee/api.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_data_for_legislature</span><span class="p">(</span>
    <span class="n">legislature</span><span class="o">=</span><span class="s2">&quot;2017-2022&quot;</span><span class="p">,</span> <span class="n">root_dir</span><span class="o">=</span><span class="s2">&quot;./data/&quot;</span><span class="p">,</span> <span class="n">max_interventions</span><span class="o">=</span><span class="mi">500</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch data for a given legislature, including interventions and deputies</span>
<span class="sd">    data.</span>

<span class="sd">    Args:</span>
<span class="sd">        legislature (str): the legislature to fetch data for.</span>
<span class="sd">        root_dir (str): the root directory to save data.</span>
<span class="sd">        max_interventions (int): the maximum number of interventions to fetch.</span>

<span class="sd">    Returns:</span>
<span class="sd">        uresults (tuple): containing the urls of the interventions, the interventions data</span>
<span class="sd">            and the deputies data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">CPCApi</span><span class="p">(</span><span class="n">legislature</span><span class="o">=</span><span class="n">legislature</span><span class="p">)</span>

    <span class="n">deps_df</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">deputies_df</span>

    <span class="n">urls</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">async_get_all_interventions_urls</span><span class="p">(</span>
        <span class="n">all_pages</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">max_interventions</span><span class="o">=</span><span class="n">max_interventions</span><span class="p">,</span>
        <span class="n">sort</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">object_name</span><span class="o">=</span><span class="s2">&quot;Intervention&quot;</span><span class="p">,</span>
        <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/interventions_urls_by_deputies.json&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">interventions</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">async_fetch_all_interventions</span><span class="p">(</span>
        <span class="n">urls</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">max_interventions</span><span class="o">=</span><span class="n">max_interventions</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">urls</span><span class="p">,</span> <span class="n">interventions</span><span class="p">,</span> <span class="n">deps_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 id="cpcapi">CPCApi<a class="headerlink" href="#cpcapi" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">API class</p>
<p>The wrapper function uses an API class inspired by the <a href="https://github.com/regardscitoyens/cpc-api">GitHub of nosdeputes.fr</a>.</p>
</div>


<div class="doc doc-object doc-class">


<a id="nlp_assemblee.api.CPCApi"></a>
  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code>object</code></p>

  
      <p>The CPCApi class provides an interface for interacting with
nosdeputes.fr's API. It allows users to retrieve information about
parliamentarians, as well as the interventions they have made.</p>
<p>The class provides asynchronous methods for fetching data, as well
as methods for processing
and saving the data. Additionally, the class contains methods for
handling pagination and
error handling. The class also provides a way to save the result of
the request to a folder
or file.</p>
<p>The class uses aiohttp, asyncio and json library to make the
request, parse the json and save
the result to a file.</p>


        <details class="quote">
          <summary>Source code in <code>nlp_assemblee/api.py</code></summary>
          <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CPCApi</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The CPCApi class provides an interface for interacting with</span>
<span class="sd">    nosdeputes.fr&#39;s API. It allows users to retrieve information about</span>
<span class="sd">    parliamentarians, as well as the interventions they have made.</span>

<span class="sd">    The class provides asynchronous methods for fetching data, as well</span>
<span class="sd">    as methods for processing</span>
<span class="sd">    and saving the data. Additionally, the class contains methods for</span>
<span class="sd">    handling pagination and</span>
<span class="sd">    error handling. The class also provides a way to save the result of</span>
<span class="sd">    the request to a folder</span>
<span class="sd">    or file.</span>

<span class="sd">    The class uses aiohttp, asyncio and json library to make the</span>
<span class="sd">    request, parse the json and save</span>
<span class="sd">    the result to a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="s2">&quot;depute&quot;</span><span class="p">,</span> <span class="n">legislature</span><span class="o">=</span><span class="s2">&quot;2017-2022&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the API object.</span>

<span class="sd">        Args:</span>
<span class="sd">            ptype (str): The type of parliamentarian to retrieve data for.</span>
<span class="sd">                Valid values are &quot;depute&quot; (deputy) or &quot;senateur&quot; (senator).</span>
<span class="sd">            legislature (str): The legislature to retrieve data for.</span>

<span class="sd">                Valid values are &quot;2007-2012&quot; or &quot;2012-2017&quot;, &quot;2017-2022&quot;,</span>
<span class="sd">                or None for current legislature.</span>

<span class="sd">                Note that older legislatures have problems for some processing later on.</span>
<span class="sd">            format (str): The format to retrieve data in.</span>
<span class="sd">                Valid values are &quot;json&quot; or &quot;xml&quot;.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AssertionError: If ptype is not &quot;depute&quot; or &quot;senateur&quot;, or if legislature is not</span>
<span class="sd">                &quot;2007-2012&quot;, &quot;2012-2017&quot;, &quot;2017-2022&quot;, or None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">ptype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;depute&quot;</span><span class="p">,</span> <span class="s2">&quot;senateur&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">legislature</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;2007-2012&quot;</span><span class="p">,</span> <span class="s2">&quot;2012-2017&quot;</span><span class="p">,</span> <span class="s2">&quot;2017-2022&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legislature</span> <span class="o">=</span> <span class="n">legislature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legislature_name</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span> <span class="k">if</span> <span class="n">legislature</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">legislature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="nb">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ptype</span> <span class="o">=</span> <span class="n">ptype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ptype_plural</span> <span class="o">=</span> <span class="n">ptype</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;www&quot;</span> <span class="k">if</span> <span class="n">legislature</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">legislature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">.nos</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ptype_plural</span><span class="si">}</span><span class="s2">.fr&quot;</span>

        <span class="c1"># Fetches the list of deputies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parlementaires</span><span class="p">()</span>  <span class="c1"># creates self.parlementaires_list</span>

        <span class="c1"># Create the dataframe of deputies and the name of the groups</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_deputies_df</span><span class="p">()</span>  <span class="c1"># creates self.deputies_df and self.groups and self.deputies</span>

    <span class="nd">@memoize</span>
    <span class="k">def</span> <span class="nf">parlementaires</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves a list of parliamentaries.</span>

<span class="sd">        Args:</span>
<span class="sd">            active (bool): Whether to retrieve active parliamentaries or not.</span>

<span class="sd">        Returns:</span>
<span class="sd">            parlementaires_list (list): A list of parliamentaries. This also creates the attribute</span>
<span class="sd">                self.parlementaires_list.</span>

<span class="sd">        Creates:</span>
<span class="sd">            self.parlementaires_list : A list of all parliamentaries</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Build the URL based on the active parameter</span>
        <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ptype_plural</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ptype_plural</span><span class="si">}</span><span class="s2">/enmandat/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Retrieve the data from the API</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="c1"># Extract the parliamentaries from the response and return them</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parlementaires_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">depute</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ptype</span><span class="p">]</span> <span class="k">for</span> <span class="n">depute</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ptype_plural</span><span class="p">]]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parlementaires_list</span>

    <span class="k">def</span> <span class="nf">search_parlementaires</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s2">&quot;nom&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fuzzy searches for a parliamentarian in the deputies list.</span>

<span class="sd">        Args:</span>
<span class="sd">            q (str): The query to search for.</span>
<span class="sd">            field (str): The field of the parliamentarian data to search in.</span>
<span class="sd">            limit (int): The maximum number of results to return.</span>

<span class="sd">        Returns:</span>
<span class="sd">            name (str): The exact name of the parliamentarian in the list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Search for parliamentarians and return the best matches</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">extractBests</span><span class="p">(</span>
            <span class="n">q</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parlementaires_list</span><span class="p">,</span>
            <span class="n">processor</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">get_deputies_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves a DataFrame of deputies information from the API.</span>

<span class="sd">        Returns:</span>
<span class="sd">            deputies_df (pandas.DataFrame): A DataFrame containing information about deputies.</span>

<span class="sd">        Creates:</span>
<span class="sd">            self.deputies_df : A DataFrame containing information about deputies</span>
<span class="sd">            self.groups : groups of the deputies</span>
<span class="sd">            self.deputies : Deputies information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Retrieve deputies data from the API</span>
        <span class="n">deputies_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parlementaires_list</span>

        <span class="c1"># Convert the JSON data to a DataFrame</span>
        <span class="n">cols_to_drop</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;sites_web&quot;</span><span class="p">,</span>
            <span class="s2">&quot;emails&quot;</span><span class="p">,</span>
            <span class="s2">&quot;adresses&quot;</span><span class="p">,</span>
            <span class="s2">&quot;collaborateurs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;anciens_autres_mandats&quot;</span><span class="p">,</span>
            <span class="s2">&quot;autres_mandats&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url_an&quot;</span><span class="p">,</span>
            <span class="s2">&quot;id_an&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url_nosdeputes&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url_nosdeputes_api&quot;</span><span class="p">,</span>
            <span class="s2">&quot;twitter&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">deputies_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">deputies_json</span><span class="p">)</span>
        <span class="n">deputies_df</span> <span class="o">=</span> <span class="n">deputies_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols_to_drop</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
        <span class="n">deputies_df</span><span class="p">[</span><span class="s2">&quot;legislature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legislature_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">deputies_df</span> <span class="o">=</span> <span class="n">deputies_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_groups</span> <span class="o">=</span> <span class="n">deputies_df</span><span class="p">[</span><span class="s2">&quot;groupe_sigle&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deputies</span> <span class="o">=</span> <span class="n">deputies_df</span><span class="p">[</span><span class="s2">&quot;nom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">deputies_df</span>

    <span class="nd">@staticmethod</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">urls_response</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">count_param</span><span class="p">,</span> <span class="n">page_param</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the json response from a url.</span>

<span class="sd">        Args:</span>
<span class="sd">            session (aiohttp.ClientSession): The session to use for the request</span>
<span class="sd">            url (str): The url to retrieve the response from</span>
<span class="sd">            count_param (str): The parameter for the number of results in the url</span>
<span class="sd">            page_param (str): The parameter for the page number in the url</span>

<span class="sd">        Returns:</span>
<span class="sd">            response (dict): The json response from the url.</span>
<span class="sd">                    Returns an empty dict if there is an error.</span>
<span class="sd">                    The dict contains keys (start, end, last_result, results)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">count_param</span> <span class="o">+</span> <span class="n">page_param</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;last_result&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="p">}</span>
        <span class="k">return</span> <span class="n">tmp</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">async_get_deputy_interventions_urls</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dep_name</span><span class="p">,</span>
        <span class="n">all_pages</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">max_interventions</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">last_int</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">sort</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the urls of the interventions of a parliamentarian.</span>

<span class="sd">        Args:</span>
<span class="sd">            dep_name (str): The name of the parliamentarian.</span>
<span class="sd">            all_pages (bool, optional): Whether to retrieve all pages of results.</span>
<span class="sd">            max_interventions (int, optional): Maximum number of interventions to retrieve.</span>
<span class="sd">            count (int, optional): The number of interventions to retrieve per page.</span>
<span class="sd">            last_int (int, optional): The last intervention number to retrieve.</span>
<span class="sd">            sort (int, optional): The sort order of the interventions, by pertinence or by date.</span>
<span class="sd">            page (int, optional): The page of results to retrieve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            response (dict): A json object containing the links to the interventions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">all_pages</span> <span class="ow">or</span> <span class="n">max_interventions</span><span class="p">:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Remove accents and special characters from the name and replace spaces with +</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_parlementaires</span><span class="p">(</span><span class="n">dep_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;nom&quot;</span><span class="p">]</span>
        <span class="n">slug_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">unidecode</span><span class="o">.</span><span class="n">unidecode</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>

        <span class="c1"># Build the URL for the search</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/recherche?object_name=Intervention&amp;format=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&amp;tag=parlementaire%3D</span><span class="si">{</span><span class="n">slug_name</span><span class="si">}</span><span class="s2">&amp;sort=</span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">page_param</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;page=</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">count_param</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;count=</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">last_int</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tick</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s2">&quot;&amp;count=0&amp;page=1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;last_result&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">all_pages</span><span class="p">:</span>
                <span class="n">last_int</span> <span class="o">=</span> <span class="n">tick</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">last_int</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_interventions</span><span class="p">,</span> <span class="n">tick</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;last_result&quot;</span><span class="p">:</span> <span class="n">last_int</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="c1"># Retrieve the search results</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">trust_env</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">last_int</span> <span class="o">//</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">page_param</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;page=</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urls_response</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">count_param</span><span class="p">,</span> <span class="n">page_param</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">:</span>
                <span class="n">response</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span>
                <span class="n">response</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>

            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;dep_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dep_name</span>
            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;slug_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slug_name</span>
            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;legislature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legislature_name</span>

            <span class="k">return</span> <span class="n">response</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">async_get_all_interventions_urls</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">all_pages</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">max_interventions</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">sort</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">count</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">object_name</span><span class="o">=</span><span class="s2">&quot;Intervention&quot;</span><span class="p">,</span>
        <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="s2">&quot;./data/interventions_urls_by_deputies.json&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the URLs for all interventions by each deputy.</span>

<span class="sd">        Args:</span>
<span class="sd">            all_pages (bool, optional): Whether to retrieve all pages of results or just the</span>
<span class="sd">                first page.</span>
<span class="sd">            max_interventions (int, optional): Maximum number of interventions to retrieve.</span>
<span class="sd">            sort (int, optional): An integer representing the sorting method to use.</span>
<span class="sd">            count (int, optional): The number of results to retrieve per page.</span>
<span class="sd">            object_name (str, optional): The name of the object to retrieve.</span>
<span class="sd">            page (int, optional): The page number to start at.</span>
<span class="sd">            verbose (bool, optional): Whether to display a progress bar.</span>
<span class="sd">            save (str, optional): The file path to save the results to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            deputies_list (dict): A dictionary where the keys are deputy names and the values</span>
<span class="sd">                are lists of URLs for their interventions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deputies_list</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">trust_env</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">deputies</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">async_get_deputy_interventions_urls</span><span class="p">(</span>
                        <span class="n">dep_name</span><span class="o">=</span><span class="n">dep</span><span class="p">,</span>
                        <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                        <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
                        <span class="n">object_name</span><span class="o">=</span><span class="n">object_name</span><span class="p">,</span>
                        <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
                        <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
                        <span class="n">all_pages</span><span class="o">=</span><span class="n">all_pages</span><span class="p">,</span>
                        <span class="n">max_interventions</span><span class="o">=</span><span class="n">max_interventions</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

            <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">dep</span><span class="p">,</span> <span class="n">response</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deputies</span><span class="p">,</span> <span class="n">responses</span><span class="p">):</span>
            <span class="n">deputies_list</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span>

        <span class="c1"># Save the results to a file if save path is provided</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save</span><span class="p">)</span>
            <span class="n">path_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span>
            <span class="n">path_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">legislature_name</span><span class="p">)</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="o">*</span><span class="n">path_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">save_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span> <span class="o">/</span> <span class="n">path_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">deputies_list</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deputies_list_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">save_path</span> <span class="o">/</span> <span class="n">path_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">deputies_list</span>

    <span class="nd">@staticmethod</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_response</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a url, this function calls the url and returns the json object</span>
<span class="sd">        associated with the url.</span>

<span class="sd">        Args:</span>
<span class="sd">            session : The aiohttp session object</span>
<span class="sd">            url : The url to call</span>

<span class="sd">        Returns:</span>
<span class="sd">            intervention (dict): json object containing the intervention details</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
            <span class="n">action_item</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">action_item</span><span class="p">[</span><span class="s2">&quot;intervention&quot;</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">async_fetch_interventions_of_deputy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dep_urls</span><span class="p">,</span> <span class="n">slug_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_interventions</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;./data/&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the interventions of a parliamentarian.</span>

<span class="sd">        Args:</span>
<span class="sd">            dep_urls (dict): A dictionary containing the links to the interventions.</span>
<span class="sd">            slug_name (str): The slug name of the parliamentarian.</span>
<span class="sd">            max_interventions (int): The maximum number of interventions to retrieve.</span>
<span class="sd">            verbose (bool): Whether to display a progress bar.</span>
<span class="sd">            save (str):The file path to save the results to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            interventions (dict): A dictionary containing the interventions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize an empty list to store the interventions</span>
        <span class="n">interventions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">dep_urls</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span>
            <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">dep_urls</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">],</span>
            <span class="s2">&quot;last_result&quot;</span><span class="p">:</span> <span class="n">dep_urls</span><span class="p">[</span><span class="s2">&quot;last_result&quot;</span><span class="p">],</span>
            <span class="s2">&quot;interventions&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>

        <span class="n">inters</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">dep_urls</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][:</span><span class="n">max_interventions</span><span class="p">]</span> <span class="k">if</span> <span class="n">max_interventions</span> <span class="k">else</span> <span class="n">dep_urls</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">intervention</span><span class="p">[</span><span class="s2">&quot;document_url&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">intervention</span> <span class="ow">in</span> <span class="n">inters</span><span class="p">]</span>
        <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="n">urls</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">trust_env</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="c1"># Fetch the interventions from the API</span>
            <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_response</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

            <span class="n">interventions</span><span class="p">[</span><span class="s2">&quot;interventions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">slug_name</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">legislature_name</span> <span class="o">/</span> <span class="s2">&quot;interventions&quot;</span>
            <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">slug_name</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">interventions</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">interventions</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">async_fetch_all_interventions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;./data/&quot;</span><span class="p">,</span> <span class="n">max_interventions</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves all interventions for each deputy and saves them to a file</span>
<span class="sd">        for each deputy.</span>

<span class="sd">        Args:</span>
<span class="sd">            urls (dict): A dictionary where the keys are deputy names and the values are lists of</span>
<span class="sd">                URLs for their interventions.</span>
<span class="sd">            save (str): The file path to save the results to.</span>
<span class="sd">            max_interventions (int): The maximum number of interventions to fetch for each deputy.</span>

<span class="sd">        Returns:</span>
<span class="sd">            interventions_dict (dict): A dictionary where the keys are the deputy names and the</span>
<span class="sd">                values are lists of their interventions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deputies</span>
        <span class="n">slugs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">deputies_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">deputies_df</span><span class="p">[</span><span class="s2">&quot;nom&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dep</span><span class="p">][</span><span class="s2">&quot;slug&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">deps</span><span class="p">]</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">legislature_name</span><span class="si">}</span><span class="s2">/interventions/*.json&quot;</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">slug</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slugs</span><span class="p">)</span> <span class="k">if</span> <span class="n">slug</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
        <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="n">deps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>
        <span class="n">slugs</span> <span class="o">=</span> <span class="p">[</span><span class="n">slugs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetching </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="si">}</span><span class="s2"> deputies&#39; interventions... Instead of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deputies</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">interventions_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">dep</span><span class="p">,</span> <span class="n">slug</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span> <span class="n">slugs</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">interventions_dict</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">async_fetch_interventions_of_deputy</span><span class="p">(</span>
                    <span class="n">dep_urls</span><span class="o">=</span><span class="n">urls</span><span class="p">[</span><span class="n">dep</span><span class="p">],</span>
                    <span class="n">slug_name</span><span class="o">=</span><span class="n">slug</span><span class="p">,</span>
                    <span class="n">max_interventions</span><span class="o">=</span><span class="n">max_interventions</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">interventions_dict</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="nlp_assemblee.api.CPCApi.__init__" class="doc doc-heading">
<code class="codehilite language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">ptype</span><span class="o">=</span><span class="s1">&#39;depute&#39;</span><span class="p">,</span> <span class="n">legislature</span><span class="o">=</span><span class="s1">&#39;2017-2022&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span></code>

<a href="#nlp_assemblee.api.CPCApi.__init__" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Initializes the API object.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ptype</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The type of parliamentarian to retrieve data for.
Valid values are "depute" (deputy) or "senateur" (senator).</p></td>
          <td>
                <code>&#39;depute&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>legislature</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The legislature to retrieve data for.</p>
<p>Valid values are "2007-2012" or "2012-2017", "2017-2022",
or None for current legislature.</p>
<p>Note that older legislatures have problems for some processing later on.</p></td>
          <td>
                <code>&#39;2017-2022&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>format</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The format to retrieve data in.
Valid values are "json" or "xml".</p></td>
          <td>
                <code>&#39;json&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>AssertionError</code>
          </td>
          <td><p>If ptype is not "depute" or "senateur", or if legislature is not
"2007-2012", "2012-2017", "2017-2022", or None.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>nlp_assemblee/api.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="s2">&quot;depute&quot;</span><span class="p">,</span> <span class="n">legislature</span><span class="o">=</span><span class="s2">&quot;2017-2022&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the API object.</span>

<span class="sd">    Args:</span>
<span class="sd">        ptype (str): The type of parliamentarian to retrieve data for.</span>
<span class="sd">            Valid values are &quot;depute&quot; (deputy) or &quot;senateur&quot; (senator).</span>
<span class="sd">        legislature (str): The legislature to retrieve data for.</span>

<span class="sd">            Valid values are &quot;2007-2012&quot; or &quot;2012-2017&quot;, &quot;2017-2022&quot;,</span>
<span class="sd">            or None for current legislature.</span>

<span class="sd">            Note that older legislatures have problems for some processing later on.</span>
<span class="sd">        format (str): The format to retrieve data in.</span>
<span class="sd">            Valid values are &quot;json&quot; or &quot;xml&quot;.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AssertionError: If ptype is not &quot;depute&quot; or &quot;senateur&quot;, or if legislature is not</span>
<span class="sd">            &quot;2007-2012&quot;, &quot;2012-2017&quot;, &quot;2017-2022&quot;, or None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">ptype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;depute&quot;</span><span class="p">,</span> <span class="s2">&quot;senateur&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">legislature</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;2007-2012&quot;</span><span class="p">,</span> <span class="s2">&quot;2012-2017&quot;</span><span class="p">,</span> <span class="s2">&quot;2017-2022&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">legislature</span> <span class="o">=</span> <span class="n">legislature</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">legislature_name</span> <span class="o">=</span> <span class="s2">&quot;last&quot;</span> <span class="k">if</span> <span class="n">legislature</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">legislature</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="nb">format</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ptype</span> <span class="o">=</span> <span class="n">ptype</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ptype_plural</span> <span class="o">=</span> <span class="n">ptype</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;www&quot;</span> <span class="k">if</span> <span class="n">legislature</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">legislature</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">.nos</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ptype_plural</span><span class="si">}</span><span class="s2">.fr&quot;</span>

    <span class="c1"># Fetches the list of deputies</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parlementaires</span><span class="p">()</span>  <span class="c1"># creates self.parlementaires_list</span>

    <span class="c1"># Create the dataframe of deputies and the name of the groups</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">get_deputies_df</span><span class="p">()</span>  <span class="c1"># creates self.deputies_df and self.groups and self.deputies</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="nlp_assemblee.api.CPCApi.async_fetch_all_interventions" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">async_fetch_all_interventions</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s1">&#39;./data/&#39;</span><span class="p">,</span> <span class="n">max_interventions</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nlp_assemblee.api.CPCApi.async_fetch_all_interventions" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Retrieves all interventions for each deputy and saves them to a file
for each deputy.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>urls</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary where the keys are deputy names and the values are lists of
URLs for their interventions.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The file path to save the results to.</p></td>
          <td>
                <code>&#39;./data/&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>max_interventions</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The maximum number of interventions to fetch for each deputy.</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>interventions_dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary where the keys are the deputy names and the
values are lists of their interventions.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>nlp_assemblee/api.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">async_fetch_all_interventions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">urls</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;./data/&quot;</span><span class="p">,</span> <span class="n">max_interventions</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves all interventions for each deputy and saves them to a file</span>
<span class="sd">    for each deputy.</span>

<span class="sd">    Args:</span>
<span class="sd">        urls (dict): A dictionary where the keys are deputy names and the values are lists of</span>
<span class="sd">            URLs for their interventions.</span>
<span class="sd">        save (str): The file path to save the results to.</span>
<span class="sd">        max_interventions (int): The maximum number of interventions to fetch for each deputy.</span>

<span class="sd">    Returns:</span>
<span class="sd">        interventions_dict (dict): A dictionary where the keys are the deputy names and the</span>
<span class="sd">            values are lists of their interventions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deputies</span>
    <span class="n">slugs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">deputies_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">deputies_df</span><span class="p">[</span><span class="s2">&quot;nom&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dep</span><span class="p">][</span><span class="s2">&quot;slug&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">deps</span><span class="p">]</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">save</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">legislature_name</span><span class="si">}</span><span class="s2">/interventions/*.json&quot;</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">slug</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slugs</span><span class="p">)</span> <span class="k">if</span> <span class="n">slug</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="n">deps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>
    <span class="n">slugs</span> <span class="o">=</span> <span class="p">[</span><span class="n">slugs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetching </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="si">}</span><span class="s2"> deputies&#39; interventions... Instead of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deputies</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">interventions_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">dep</span><span class="p">,</span> <span class="n">slug</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span> <span class="n">slugs</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">interventions_dict</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">async_fetch_interventions_of_deputy</span><span class="p">(</span>
                <span class="n">dep_urls</span><span class="o">=</span><span class="n">urls</span><span class="p">[</span><span class="n">dep</span><span class="p">],</span>
                <span class="n">slug_name</span><span class="o">=</span><span class="n">slug</span><span class="p">,</span>
                <span class="n">max_interventions</span><span class="o">=</span><span class="n">max_interventions</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">interventions_dict</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="nlp_assemblee.api.CPCApi.async_fetch_interventions_of_deputy" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">async_fetch_interventions_of_deputy</span><span class="p">(</span><span class="n">dep_urls</span><span class="p">,</span> <span class="n">slug_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_interventions</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s1">&#39;./data/&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nlp_assemblee.api.CPCApi.async_fetch_interventions_of_deputy" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Retrieves the interventions of a parliamentarian.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dep_urls</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary containing the links to the interventions.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>slug_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The slug name of the parliamentarian.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_interventions</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The maximum number of interventions to retrieve.</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to display a progress bar.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The file path to save the results to.</p></td>
          <td>
                <code>&#39;./data/&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>interventions</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary containing the interventions.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>nlp_assemblee/api.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">async_fetch_interventions_of_deputy</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">dep_urls</span><span class="p">,</span> <span class="n">slug_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_interventions</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s2">&quot;./data/&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves the interventions of a parliamentarian.</span>

<span class="sd">    Args:</span>
<span class="sd">        dep_urls (dict): A dictionary containing the links to the interventions.</span>
<span class="sd">        slug_name (str): The slug name of the parliamentarian.</span>
<span class="sd">        max_interventions (int): The maximum number of interventions to retrieve.</span>
<span class="sd">        verbose (bool): Whether to display a progress bar.</span>
<span class="sd">        save (str):The file path to save the results to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        interventions (dict): A dictionary containing the interventions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize an empty list to store the interventions</span>
    <span class="n">interventions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">dep_urls</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span>
        <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">dep_urls</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">],</span>
        <span class="s2">&quot;last_result&quot;</span><span class="p">:</span> <span class="n">dep_urls</span><span class="p">[</span><span class="s2">&quot;last_result&quot;</span><span class="p">],</span>
        <span class="s2">&quot;interventions&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="p">}</span>

    <span class="n">inters</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">dep_urls</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][:</span><span class="n">max_interventions</span><span class="p">]</span> <span class="k">if</span> <span class="n">max_interventions</span> <span class="k">else</span> <span class="n">dep_urls</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">intervention</span><span class="p">[</span><span class="s2">&quot;document_url&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">intervention</span> <span class="ow">in</span> <span class="n">inters</span><span class="p">]</span>
    <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="n">urls</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">trust_env</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="c1"># Fetch the interventions from the API</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">process_response</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

        <span class="n">interventions</span><span class="p">[</span><span class="s2">&quot;interventions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">slug_name</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">legislature_name</span> <span class="o">/</span> <span class="s2">&quot;interventions&quot;</span>
        <span class="n">path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">slug_name</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">interventions</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">interventions</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="nlp_assemblee.api.CPCApi.async_get_all_interventions_urls" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">async_get_all_interventions_urls</span><span class="p">(</span><span class="n">all_pages</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_interventions</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">object_name</span><span class="o">=</span><span class="s1">&#39;Intervention&#39;</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="s1">&#39;./data/interventions_urls_by_deputies.json&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nlp_assemblee.api.CPCApi.async_get_all_interventions_urls" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Retrieves the URLs for all interventions by each deputy.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>all_pages</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to retrieve all pages of results or just the
first page.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>max_interventions</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Maximum number of interventions to retrieve.</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>sort</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>An integer representing the sorting method to use.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>count</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of results to retrieve per page.</p></td>
          <td>
                <code>500</code>
          </td>
        </tr>
        <tr>
          <td><code>object_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the object to retrieve.</p></td>
          <td>
                <code>&#39;Intervention&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>page</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The page number to start at.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to display a progress bar.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The file path to save the results to.</p></td>
          <td>
                <code>&#39;./data/interventions_urls_by_deputies.json&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>deputies_list</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A dictionary where the keys are deputy names and the values
are lists of URLs for their interventions.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>nlp_assemblee/api.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">async_get_all_interventions_urls</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">all_pages</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">max_interventions</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">sort</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">object_name</span><span class="o">=</span><span class="s2">&quot;Intervention&quot;</span><span class="p">,</span>
    <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">save</span><span class="o">=</span><span class="s2">&quot;./data/interventions_urls_by_deputies.json&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves the URLs for all interventions by each deputy.</span>

<span class="sd">    Args:</span>
<span class="sd">        all_pages (bool, optional): Whether to retrieve all pages of results or just the</span>
<span class="sd">            first page.</span>
<span class="sd">        max_interventions (int, optional): Maximum number of interventions to retrieve.</span>
<span class="sd">        sort (int, optional): An integer representing the sorting method to use.</span>
<span class="sd">        count (int, optional): The number of results to retrieve per page.</span>
<span class="sd">        object_name (str, optional): The name of the object to retrieve.</span>
<span class="sd">        page (int, optional): The page number to start at.</span>
<span class="sd">        verbose (bool, optional): Whether to display a progress bar.</span>
<span class="sd">        save (str, optional): The file path to save the results to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        deputies_list (dict): A dictionary where the keys are deputy names and the values</span>
<span class="sd">            are lists of URLs for their interventions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">deputies_list</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">trust_env</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">deputies</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">async_get_deputy_interventions_urls</span><span class="p">(</span>
                    <span class="n">dep_name</span><span class="o">=</span><span class="n">dep</span><span class="p">,</span>
                    <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
                    <span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">,</span>
                    <span class="n">object_name</span><span class="o">=</span><span class="n">object_name</span><span class="p">,</span>
                    <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span>
                    <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
                    <span class="n">all_pages</span><span class="o">=</span><span class="n">all_pages</span><span class="p">,</span>
                    <span class="n">max_interventions</span><span class="o">=</span><span class="n">max_interventions</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>

        <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">dep</span><span class="p">,</span> <span class="n">response</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deputies</span><span class="p">,</span> <span class="n">responses</span><span class="p">):</span>
        <span class="n">deputies_list</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span>

    <span class="c1"># Save the results to a file if save path is provided</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">save</span><span class="p">)</span>
        <span class="n">path_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span>
        <span class="n">path_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">legislature_name</span><span class="p">)</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="o">*</span><span class="n">path_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">save_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span> <span class="o">/</span> <span class="n">path_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">deputies_list</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deputies_list_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">save_path</span> <span class="o">/</span> <span class="n">path_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">deputies_list</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="nlp_assemblee.api.CPCApi.async_get_deputy_interventions_urls" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">async_get_deputy_interventions_urls</span><span class="p">(</span><span class="n">dep_name</span><span class="p">,</span> <span class="n">all_pages</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_interventions</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">last_int</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nlp_assemblee.api.CPCApi.async_get_deputy_interventions_urls" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Retrieves the urls of the interventions of a parliamentarian.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dep_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The name of the parliamentarian.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>all_pages</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to retrieve all pages of results.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>max_interventions</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Maximum number of interventions to retrieve.</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>count</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The number of interventions to retrieve per page.</p></td>
          <td>
                <code>500</code>
          </td>
        </tr>
        <tr>
          <td><code>last_int</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The last intervention number to retrieve.</p></td>
          <td>
                <code>500</code>
          </td>
        </tr>
        <tr>
          <td><code>sort</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The sort order of the interventions, by pertinence or by date.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>page</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The page of results to retrieve.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>response</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>A json object containing the links to the interventions.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>nlp_assemblee/api.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">async_get_deputy_interventions_urls</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dep_name</span><span class="p">,</span>
    <span class="n">all_pages</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">max_interventions</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">count</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">last_int</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">sort</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves the urls of the interventions of a parliamentarian.</span>

<span class="sd">    Args:</span>
<span class="sd">        dep_name (str): The name of the parliamentarian.</span>
<span class="sd">        all_pages (bool, optional): Whether to retrieve all pages of results.</span>
<span class="sd">        max_interventions (int, optional): Maximum number of interventions to retrieve.</span>
<span class="sd">        count (int, optional): The number of interventions to retrieve per page.</span>
<span class="sd">        last_int (int, optional): The last intervention number to retrieve.</span>
<span class="sd">        sort (int, optional): The sort order of the interventions, by pertinence or by date.</span>
<span class="sd">        page (int, optional): The page of results to retrieve.</span>

<span class="sd">    Returns:</span>
<span class="sd">        response (dict): A json object containing the links to the interventions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">all_pages</span> <span class="ow">or</span> <span class="n">max_interventions</span><span class="p">:</span>
        <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Remove accents and special characters from the name and replace spaces with +</span>
    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_parlementaires</span><span class="p">(</span><span class="n">dep_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;nom&quot;</span><span class="p">]</span>
    <span class="n">slug_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">unidecode</span><span class="o">.</span><span class="n">unidecode</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>

    <span class="c1"># Build the URL for the search</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/recherche?object_name=Intervention&amp;format=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&amp;tag=parlementaire%3D</span><span class="si">{</span><span class="n">slug_name</span><span class="si">}</span><span class="s2">&amp;sort=</span><span class="si">{</span><span class="n">sort</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">page_param</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;page=</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">count_param</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;count=</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">last_int</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tick</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s2">&quot;&amp;count=0&amp;page=1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;last_result&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">all_pages</span><span class="p">:</span>
            <span class="n">last_int</span> <span class="o">=</span> <span class="n">tick</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">last_int</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_interventions</span><span class="p">,</span> <span class="n">tick</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;last_result&quot;</span><span class="p">:</span> <span class="n">last_int</span><span class="p">,</span> <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="c1"># Retrieve the search results</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">trust_env</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">last_int</span> <span class="o">//</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">page_param</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&amp;page=</span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">urls_response</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">count_param</span><span class="p">,</span> <span class="n">page_param</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">:</span>
            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span>
            <span class="n">response</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span>

        <span class="n">response</span><span class="p">[</span><span class="s2">&quot;dep_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dep_name</span>
        <span class="n">response</span><span class="p">[</span><span class="s2">&quot;slug_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slug_name</span>
        <span class="n">response</span><span class="p">[</span><span class="s2">&quot;legislature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legislature_name</span>

        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="nlp_assemblee.api.CPCApi.get_deputies_df" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">get_deputies_df</span><span class="p">()</span></code>

<a href="#nlp_assemblee.api.CPCApi.get_deputies_df" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Retrieves a DataFrame of deputies information from the API.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>deputies_df</code></td>          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>A DataFrame containing information about deputies.</p></td>
        </tr>
    </tbody>
  </table>

<details class="creates">
  <summary>Creates</summary>
  <p>self.deputies_df : A DataFrame containing information about deputies
self.groups : groups of the deputies
self.deputies : Deputies information</p>
</details>
      <details class="quote">
        <summary>Source code in <code>nlp_assemblee/api.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_deputies_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves a DataFrame of deputies information from the API.</span>

<span class="sd">    Returns:</span>
<span class="sd">        deputies_df (pandas.DataFrame): A DataFrame containing information about deputies.</span>

<span class="sd">    Creates:</span>
<span class="sd">        self.deputies_df : A DataFrame containing information about deputies</span>
<span class="sd">        self.groups : groups of the deputies</span>
<span class="sd">        self.deputies : Deputies information</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Retrieve deputies data from the API</span>
    <span class="n">deputies_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parlementaires_list</span>

    <span class="c1"># Convert the JSON data to a DataFrame</span>
    <span class="n">cols_to_drop</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;sites_web&quot;</span><span class="p">,</span>
        <span class="s2">&quot;emails&quot;</span><span class="p">,</span>
        <span class="s2">&quot;adresses&quot;</span><span class="p">,</span>
        <span class="s2">&quot;collaborateurs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;anciens_autres_mandats&quot;</span><span class="p">,</span>
        <span class="s2">&quot;autres_mandats&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url_an&quot;</span><span class="p">,</span>
        <span class="s2">&quot;id_an&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url_nosdeputes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url_nosdeputes_api&quot;</span><span class="p">,</span>
        <span class="s2">&quot;twitter&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">deputies_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">deputies_json</span><span class="p">)</span>
    <span class="n">deputies_df</span> <span class="o">=</span> <span class="n">deputies_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols_to_drop</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
    <span class="n">deputies_df</span><span class="p">[</span><span class="s2">&quot;legislature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">legislature_name</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">deputies_df</span> <span class="o">=</span> <span class="n">deputies_df</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">all_groups</span> <span class="o">=</span> <span class="n">deputies_df</span><span class="p">[</span><span class="s2">&quot;groupe_sigle&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">deputies</span> <span class="o">=</span> <span class="n">deputies_df</span><span class="p">[</span><span class="s2">&quot;nom&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">deputies_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="nlp_assemblee.api.CPCApi.parlementaires" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">parlementaires</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nlp_assemblee.api.CPCApi.parlementaires" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Retrieves a list of parliamentaries.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>active</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to retrieve active parliamentaries or not.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>parlementaires_list</code></td>          <td>
                <code>list</code>
          </td>
          <td><p>A list of parliamentaries. This also creates the attribute
self.parlementaires_list.</p></td>
        </tr>
    </tbody>
  </table>

<details class="creates">
  <summary>Creates</summary>
  <p>self.parlementaires_list : A list of all parliamentaries</p>
</details>
      <details class="quote">
        <summary>Source code in <code>nlp_assemblee/api.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@memoize</span>
<span class="k">def</span> <span class="nf">parlementaires</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves a list of parliamentaries.</span>

<span class="sd">    Args:</span>
<span class="sd">        active (bool): Whether to retrieve active parliamentaries or not.</span>

<span class="sd">    Returns:</span>
<span class="sd">        parlementaires_list (list): A list of parliamentaries. This also creates the attribute</span>
<span class="sd">            self.parlementaires_list.</span>

<span class="sd">    Creates:</span>
<span class="sd">        self.parlementaires_list : A list of all parliamentaries</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Build the URL based on the active parameter</span>
    <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ptype_plural</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ptype_plural</span><span class="si">}</span><span class="s2">/enmandat/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Retrieve the data from the API</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="c1"># Extract the parliamentaries from the response and return them</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parlementaires_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">depute</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ptype</span><span class="p">]</span> <span class="k">for</span> <span class="n">depute</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ptype_plural</span><span class="p">]]</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parlementaires_list</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="nlp_assemblee.api.CPCApi.process_response" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">process_response</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nlp_assemblee.api.CPCApi.process_response" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Given a url, this function calls the url and returns the json object
associated with the url.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>session</code></td>
          <td>
          </td>
          <td><p>The aiohttp session object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>url</code></td>
          <td>
          </td>
          <td><p>The url to call</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>intervention</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>json object containing the intervention details</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>nlp_assemblee/api.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">process_response</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a url, this function calls the url and returns the json object</span>
<span class="sd">    associated with the url.</span>

<span class="sd">    Args:</span>
<span class="sd">        session : The aiohttp session object</span>
<span class="sd">        url : The url to call</span>

<span class="sd">    Returns:</span>
<span class="sd">        intervention (dict): json object containing the intervention details</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
        <span class="n">action_item</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">action_item</span><span class="p">[</span><span class="s2">&quot;intervention&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="nlp_assemblee.api.CPCApi.search_parlementaires" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">search_parlementaires</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;nom&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>

<a href="#nlp_assemblee.api.CPCApi.search_parlementaires" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Fuzzy searches for a parliamentarian in the deputies list.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>q</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The query to search for.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>field</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The field of the parliamentarian data to search in.</p></td>
          <td>
                <code>&#39;nom&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>limit</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The maximum number of results to return.</p></td>
          <td>
                <code>5</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>name</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The exact name of the parliamentarian in the list.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>nlp_assemblee/api.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">search_parlementaires</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s2">&quot;nom&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fuzzy searches for a parliamentarian in the deputies list.</span>

<span class="sd">    Args:</span>
<span class="sd">        q (str): The query to search for.</span>
<span class="sd">        field (str): The field of the parliamentarian data to search in.</span>
<span class="sd">        limit (int): The maximum number of results to return.</span>

<span class="sd">    Returns:</span>
<span class="sd">        name (str): The exact name of the parliamentarian in the list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Search for parliamentarians and return the best matches</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">extractBests</span><span class="p">(</span>
        <span class="n">q</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parlementaires_list</span><span class="p">,</span>
        <span class="n">processor</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">name</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="nlp_assemblee.api.CPCApi.urls_response" class="doc doc-heading">
<code class="codehilite language-python"><span class="n">urls_response</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">count_param</span><span class="p">,</span> <span class="n">page_param</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nlp_assemblee.api.CPCApi.urls_response" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Retrieves the json response from a url.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>session</code></td>
          <td>
                <code>aiohttp.<span title="aiohttp.ClientSession">ClientSession</span></code>
          </td>
          <td><p>The session to use for the request</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>url</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The url to retrieve the response from</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>count_param</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The parameter for the number of results in the url</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>page_param</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The parameter for the page number in the url</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>response</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>The json response from the url.
    Returns an empty dict if there is an error.
    The dict contains keys (start, end, last_result, results)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>nlp_assemblee/api.py</code></summary>
        <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">urls_response</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">count_param</span><span class="p">,</span> <span class="n">page_param</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves the json response from a url.</span>

<span class="sd">    Args:</span>
<span class="sd">        session (aiohttp.ClientSession): The session to use for the request</span>
<span class="sd">        url (str): The url to retrieve the response from</span>
<span class="sd">        count_param (str): The parameter for the number of results in the url</span>
<span class="sd">        page_param (str): The parameter for the page number in the url</span>

<span class="sd">    Returns:</span>
<span class="sd">        response (dict): The json response from the url.</span>
<span class="sd">                Returns an empty dict if there is an error.</span>
<span class="sd">                The dict contains keys (start, end, last_result, results)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">count_param</span> <span class="o">+</span> <span class="n">page_param</span><span class="p">)</span> <span class="k">as</span> <span class="n">resp</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="k">await</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;last_result&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="p">}</span>
    <span class="k">return</span> <span class="n">tmp</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

              
            </article>
            
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../../notebooks/experiments/topic_modelling/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Topic Modelling" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Topic Modelling
            </div>
          </div>
        </a>
      
      
        
        <a href="../data_processing/" class="md-footer__link md-footer__link--next" aria-label="Next: Data Processing" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Data Processing
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; MIT; 2023 Gabriel WATKINSON, JÃ©remie STYM-POPPER
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/gwatkinson/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.top", "search.suggest", "navigation.footer", "content.action.edit"], "search": "../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": "0.0.1"}</script>
    
    
      <script src="../../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/gh/rod2ik/cdn@main/mkdocs/javascripts/mkdocs-graphviz.js"></script>
      
    
  </body>
</html>